apiVersion: batch/v1
kind: CronJob
metadata:
  labels:
    name: job
    app.kubernetes.io/version: pr-1234
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: job
    app.kubernetes.io/instance: job
    maintainers: MPyL
    maintainer: MPyL
    version: pr-1234
    revision: 2ad3293a7675d08bc037ef0846ef55897f38ec8f
  name: job
spec:
  concurrencyPolicy: Allow
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      activeDeadlineSeconds: 10
      template:
        metadata:
          labels:
            name: job
            app.kubernetes.io/version: pr-1234
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/name: job
            app.kubernetes.io/instance: job
            maintainers: MPyL
            maintainer: MPyL
            version: pr-1234
            revision: 2ad3293a7675d08bc037ef0846ef55897f38ec8f
          name: job
        spec:
          containers:
          - env:
            - name: SOME_SECRET_ENV
              valueFrom:
                secretKeyRef:
                  key: SOME_SECRET_ENV
                  name: job
                  optional: false
            image: registry/image:123
            imagePullPolicy: Always
            name: job
            resources:
              limits:
                cpu: 500m
                memory: 1024Mi
              requests:
                cpu: 100m
                memory: 512Mi
          serviceAccount: job
          serviceAccountName: job
      ttlSecondsAfterFinished: 3600
  schedule: 0 22 * * *
  successfulJobsHistoryLimit: 3
  suspend: true
