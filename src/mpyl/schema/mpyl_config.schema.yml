"$schema": http://json-schema.org/draft-07/schema#
"$ref": "#/definitions/Config"
definitions:
  Config:
    type: object
    additionalProperties: false
    properties:
      cvs:
        "$ref": "#/definitions/CVS"
      docker:
        "$ref": "#/definitions/Docker"
      kubernetes:
        "$ref": "#/definitions/Kubernetes"
      project:
        "$ref": "#/definitions/Project"
    required:
      - cvs
      - docker
    title: MPyL global configuration
  Kubernetes:
    type: object
    additionalProperties: false
    properties:
      rancher:
        type: object
        additionalProperties: false
        properties:
          cluster:
            "$ref": "#/definitions/RancherClusters"
  RancherClusters:
    type: object
    additionalProperties: false
    properties:
      test:
        "$ref": "#/definitions/RancherCluster"
      acceptance:
        "$ref": "#/definitions/RancherCluster"
      production:
        "$ref": "#/definitions/RancherCluster"
  RancherCluster:
    type: object
    additionalProperties: false
    properties:
      clusterId:
        type: string
      projectId:
        type: string
      clusterEnv:
        type: string
      context:
        type: string
    required: [ clusterId, projectId, clusterEnv, context ]
  CVS:
    type: object
    additionalProperties: false
    properties:
      git:
        "$ref": "#/definitions/Git"
      github:
        "$ref": "#/definitions/Github"
    required:
      - git
      - github
    title: CVS
  Git:
    type: object
    additionalProperties: false
    properties:
      mainBranch:
        type: string
    required:
      - mainBranch
    title: Git
  Github:
    type: object
    additionalProperties: false
    properties:
      repository:
        type: string
      token:
        type: string
      app:
        type: object
        properties:
          privateKeyPath:
            description: Used to authenticate with github if the app is used (https://github.com/apps/mpyl-pipeline)
            type: string
          appId:
            description: The id of the github app (https://github.com/apps/mpyl-pipeline) that has permission to update checks
            type: string
            default: 295700
        required:
          - privateKeyPath
          - appId
    required:
      - repository
      - token
    title: Github
  Docker:
    type: object
    additionalProperties: false
    properties:
      registry:
        "$ref": "#/definitions/Registry"
      build:
        "$ref" : "#/definitions/Build"
    required:
      - registry
    title: Docker
  Build:
    type: object
    additionalProperties: false
    properties:
      rootFolder:
        type: string
      buildTarget:
        description: "The target in the multi-stage docker file to build in the 'build' stage"
        type: string
      testTarget:
        description: "The target in the multi-stage docker file to build in the 'test' stage"
        type: string
      dockerFileName:
        type: string
    required: [ rootFolder, buildTarget, dockerFileName ]
  Registry:
    type: object
    additionalProperties: false
    properties:
      hostName:
        type: string
      userName:
        type: string
      password:
        type: string
    required:
      - hostName
      - password
      - userName
    title: Registry
  Project:
    type: object
    additionalProperties: false
    properties:
      deployment:
        type: object
        additionalProperties: false
        properties:
          kubernetes:
             "$ref": "project.schema.yml#/definitions/kubernetes"
